/** 
 * jibo-tools - API for jibo-atom and jibo-cli
 * @version v2.4.5
 * Copyright (c) 2016, Jibo, Inc. All rights reserved.
 * All use of the Jibo SDK is subject to the Jibo SDK End User License Agreement (EULA) 
 * distributed herewith.  If you did not receive a copy of the EULA, you may view a
 * copy at https://developers.jibo.com/license.
 */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;t="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,t.client=e()}}(function(){return function e(t,i,n){function s(o,r){if(!i[o]){if(!t[o]){var d="function"==typeof require&&require;if(!r&&d)return d(o,!0);if(a)return a(o,!0);var c=new Error("Cannot find module '"+o+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[o]={exports:{}};t[o][0].call(u.exports,function(e){var i=t[o][1][e];return s(i?i:e)},u,u.exports,e,t,i,n)}return i[o].exports}for(var a="function"==typeof require&&require,o=0;o<n.length;o++)s(n[o]);return s}({1:[function(e,t,i){"use strict";t.exports={SCREEN_WIDTH:1280,SCREEN_HEIGHT:720,SCREEN_EPSILON:2,CHAT_WIDTH:400}},{}],2:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e){let t,i,n,s,a=0,o=e[2];e[2]=e[3],e[3]=o;for(let r=0;r<e.length;r++)t=e[r].x,i=e[r].y,r===e.length-1?(n=e[0].x,s=e[0].y):(n=e[r+1].x,s=e[r+1].y),a+=t*s-n*i;return 0>a}function a(e,t,i){var n=.5*parseInt(window.innerWidth-_["default"].CHAT_WIDTH),s=.5*parseInt(window.innerHeight);t.updateMatrixWorld(),t.geometry.boundingBox||t.geometry.computeBoundingBox();for(var a,o=[new e.Vector3(t.geometry.boundingBox.max.x,t.geometry.boundingBox.max.y,t.geometry.boundingBox.max.z),new e.Vector3(t.geometry.boundingBox.min.x,t.geometry.boundingBox.max.y,t.geometry.boundingBox.max.z),new e.Vector3(t.geometry.boundingBox.max.x,t.geometry.boundingBox.min.y,t.geometry.boundingBox.min.z),new e.Vector3(t.geometry.boundingBox.min.x,t.geometry.boundingBox.min.y,t.geometry.boundingBox.min.z)],r=[],d=0;d<o.length;d++)a=o[d].applyMatrix4(t.matrixWorld),a.project(i),a.x=a.x*n+n,a.y=-(a.y*s)+s,r.push({x:Math.floor(a.x),y:Math.floor(a.y)});return r}function o(e){return[e[4]*e[8]-e[5]*e[7],e[2]*e[7]-e[1]*e[8],e[1]*e[5]-e[2]*e[4],e[5]*e[6]-e[3]*e[8],e[0]*e[8]-e[2]*e[6],e[2]*e[3]-e[0]*e[5],e[3]*e[7]-e[4]*e[6],e[1]*e[6]-e[0]*e[7],e[0]*e[4]-e[1]*e[3]]}function r(e,t){for(var i=Array(9),n=0;3!=n;++n)for(var s=0;3!=s;++s){for(var a=0,o=0;3!=o;++o)a+=e[3*n+o]*t[3*o+s];i[3*n+s]=a}return i}function d(e,t){return[e[0]*t[0]+e[1]*t[1]+e[2]*t[2],e[3]*t[0]+e[4]*t[1]+e[5]*t[2],e[6]*t[0]+e[7]*t[1]+e[8]*t[2]]}function c(e,t,i,n,s,a,c,u){var l=[e,i,s,t,n,a,1,1,1],f=d(o(l),[c,u,1]);return r(l,[f[0],0,0,0,f[1],0,0,0,f[2]])}function u(e,t,i,n,s,a,d,u,l,f,h,p,m,v,g,y){var _=c(e,t,s,a,l,f,m,v),S=c(i,n,d,u,h,p,g,y);return r(S,o(_))}function l(e,t,i,n,s,a,o,r,d){for(var c=e.offsetWidth-_["default"].SCREEN_EPSILON,l=e.offsetHeight-_["default"].SCREEN_EPSILON,f=u(0,0,t,i,c,0,n,s,0,l,a,o,c,l,r,d),h=0;9!=h;++h)f[h]=f[h]/f[8];f=[f[0],f[3],0,f[6],f[1],f[4],0,f[7],0,0,1,0,f[2],f[5],0,f[8]],f="matrix3d("+f.join(", ")+")",e.style["-webkit-transform"]=f,e.style["-moz-transform"]=f,e.style["-o-transform"]=f,e.style.transform=f}function f(e,t){l(t,e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7])}var h=e("ipc"),p=n(h),m=e("three"),v=n(m),g=e("animation-utilities"),y=e("./dimensions"),_=n(y),S=e("react"),w=n(S),b=e("./views/toolbar"),E=n(b),k=e("./services/lps-service"),x=n(k);let T,N={viewFront:{position:new v["default"].Vector3(.5,0,.35),lookat:new v["default"].Vector3(0,0,.15),fov:45},viewTop:{position:new v["default"].Vector3(0,0,1),lookat:new v["default"].Vector3(0,0,.15),fov:45},viewReset:{position:new v["default"].Vector3(.5,0,.35),lookat:new v["default"].Vector3(0,0,.15),fov:45}},C={viewFront:{x:1,y:1,z:0},viewTop:{x:1,y:1,z:0},viewReset:{x:1,y:1,z:0}},O=!1,R=[];t.exports={init:function(e,t,i,n,o,r){var d=this;this.face=i,this.container=t,this.faceContent=document.getElementById("faceContent"),this.selectedPlane=C.viewFront,this.sidebar=document.getElementById("sidebar"),this.pageTitle=document.title,T=JSON.parse(p["default"].sendSync("get-simulator-settings")),this.sidebar.className=this.container.className="view"+T.viewMode+" loading","3d"===T.viewMode&&(n.style.width=window.innerWidth+"px",n.style.height=window.innerHeight+"px"),document.body.style.cursor||(document.body.style.cursor="default"),this.initializeToolbar();let c=function(){d.face.style.transformOrigin="0 0","2d"===T.viewMode?(d.faceContent.style.transform=`scale(1.0)`,d.face.style.width=_["default"].SCREEN_WIDTH+2+"px",d.face.style.height=_["default"].SCREEN_HEIGHT+2+"px",d.face.style.top=void 0,d.face.style.left=void 0,d.face.style.position="absolute",n.style.position="absolute",d.hideToolbar()):(d.face.style.marginLeft="0px",d.face.style.marginTop="0px",d.face.style.width=_["default"].SCREEN_WIDTH+_["default"].SCREEN_EPSILON+"px",d.face.style.height=_["default"].SCREEN_HEIGHT+_["default"].SCREEN_EPSILON+"px",d.face.style.top="0px",d.face.style.left="0px",d.robotRenderer.setBackgroundColor(.25,.25,.25,1),d.robotRenderer.setGrid(.05,6,new v["default"].Color("rgb(128, 128, 128)")),d.robotRenderer.scene._camera.near=.001,d.robotRenderer.scene._camera.updateProjectionMatrix(),d.showToolbar())},u=function(){let e=T.zoomFactor*T.devicePixelRatio;if("2d"===T.viewMode){d.sidebar.className=d.container.className="view2d",d.faceContent.style.transform=`scale(${T.zoomFactor})`;let t=_["default"].SCREEN_WIDTH*T.zoomFactor,i=_["default"].SCREEN_HEIGHT*T.zoomFactor;t<window.innerWidth?d.face.style.marginLeft=Math.floor((window.innerWidth-_["default"].CHAT_WIDTH-t)/2)+"px":d.face.style.marginLeft="0px",i<window.innerHeight?d.face.style.marginTop=Math.floor((window.innerHeight-i)/2)+"px":d.face.style.marginTop="0px",document.title=`${d.pageTitle} (${Math.floor(e*100)}%)`}else d.sidebar.className=d.container.className="view3d",d.faceContent.style.transform=`scale(1.0)`,n.style.width=window.innerWidth-_["default"].CHAT_WIDTH+"px",n.style.height=window.innerHeight+"px",d.robotRenderer.scene.handleResize(),document.title=`${d.pageTitle} (3D)`};window.onDimensionChanges=u,window.onViewModeChange=c,g.visualize.createRobotRenderer(e,n,g.visualize.DisplayType.BODY,function(e){d.robotRenderer=e,d.container.className+="loading",c(),u();let t=["movedown","mousemove","mouseup","mousewheel"],i=["shiftKey","ctrlKey","altKey","metaKey"];if(t.forEach(function(e){document.addEventListener(e,function(e){for(let t=0;t<i.length;t++)if(e[i[t]])return d.robotRenderer.scene._container.style.pointerEvents="all",void(d.face.style.pointerEvents="none");d.robotRenderer.scene._container.style.pointerEvents="none",d.face.style.pointerEvents="all"})}),O)for(let n=["red","green","purple","blue"],l=0;4>l;l++)R.push(document.createElement("div")),R[l].style.position="absolute",R[l].style.width="5px",R[l].style.height="5px",R[l].style.background=n[l],document.body.firstChild?document.body.insertBefore(R[l],document.body.firstChild):document.body.appendChild(R[l]);d.robotRenderer.scene._postRenderCallbacks.push(function(){if("3d"===T.viewMode){var e=d.robotRenderer.scene._scene.children[4].children[0].children[1].children[1].children[0].children[2].children[0],t=d.robotRenderer.scene._camera,i=a(v["default"],e,t);if(O)for(let n=0;n<R.length;n++)R[n].style.marginLeft=Math.floor(i[n].x)+"px",R[n].style.marginTop=Math.floor(i[n].y)+"px";f([i[0].x,i[0].y,i[1].x,i[1].y,i[2].x,i[2].y,i[3].x,i[3].y],d.face),d.face.style.zIndex=s(i)?"-1":"0"}});let h=document.getElementById("container");h.addEventListener("mousedown",function(e){let t=d.getClicked3DPoint(e);"audio"===d.mode&&(e.stopPropagation(),e.preventDefault(),x["default"].triggerAudioEvent(t))}),h.addEventListener("mouseup",function(){"audio"===d.mode&&x["default"].triggerAudioEventEnd()}),p["default"].on("simulator-settings-changed",function(e){let t=T;T=JSON.parse(e),o(t,T),t.viewMode!==T.viewMode&&c(),u()}),window.addEventListener("resize",function(){u()}),d.container.className=d.container.className.replace("loading",""),r(null,e,T,u)})},initializeToolbar:function(){let e=document.getElementById("toolbar");w["default"].render(w["default"].createElement(E["default"],{setMode:this.setMode.bind(this),setCamera:this.setCamera.bind(this)}),e)},hideToolbar:function(){document.getElementById("toolbar").className+=" hide"},showToolbar:function(){let e=document.getElementById("toolbar");e.className=e.className.replace("hide","")},setCamera:function(e){this.robotRenderer.scene._controls.reset();let t=N[e];this.selectedPlane=C[e],this.robotRenderer.setCamera(t.position,t.lookat,t.fov)},getClicked3DPoint:function(e){let t=document.getElementById("visualizer"),i=this.robotRenderer.scene.getCamera(),n=g.MouseCoordinateWrangler.unprojectEventToPlane(e,t,i,this.selectedPlane,{x:0,y:0,z:1});return n},setMode(e){this.mode=e}}},{"./dimensions":1,"./services/lps-service":7,"./views/toolbar":20,"animation-utilities":void 0,ipc:void 0,react:void 0,three:void 0}],3:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("react"),a=n(s);i["default"]=a["default"].createClass({displayName:"tab-bar",getInitialState(){return{activeTab:0}},render(){var e=this;let t=[];return this.props.tabs.forEach(function(i,n){let s="main";n===e.state.activeTab&&(s+=" selected"),t.push(a["default"].createElement("button",{key:i.id,id:i.id,onClick:e.onClick.bind(e,n,i.callback),className:s},a["default"].createElement("span",{className:i.icon,title:i.label})))}),a["default"].createElement("div",{className:"tools",id:"tabBar"},t)},onClick(e,t){this.state.activeTab=e,this.setState(this.state),t()}})},{react:void 0}],4:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e){let t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i={status:e.status||"incomprehensible error",audio_source_id:e.audio_source_id||"",final_composite:e.final_composite||!1,final_simple:e.final_simple||!1,sd_status:e.sd_status||"na",simple_recog_name:e.simple_recog_name||"",speaker_ids:e.speaker_ids||[],speaker_idstatus:e.speaker_idstatus||"",task_id:e.task_id||"",timestamp:e.timestamp||0,utterances:e.utterances||[],human_timestamp:e.human_timestamp||"",message:e.message||"",message_id:e.message_id||d["default"].v4(),request_id:e.request_id||d["default"].v4()};return Object.keys(t).forEach(function(e){i[e]=t[e]}),i}Object.defineProperty(i,"__esModule",{value:!0});var a=e("http"),o=n(a),r=e("uuid"),d=n(r),c=e("websocket-without-native");class u{constructor(){this.port=11274;this.connectionHandlers={"/asr_interface":this.onAsrInterface.bind(this),"/audio_source":this.onAudioSource.bind(this),"/spkr_id_interface":this.onSpkrId.bind(this)};this.messages=[];this.sources=[];this.actions=[];this.tasks=[]}init(e){var t=this;this.httpServer=o.default.createServer();this.httpServer.on("request",function(e,i){if(e.method==="POST"){e.setEncoding("utf8");e.on("data",function(n){let s;try{s=JSON.parse(n);t.messages.push({url:e.url,data:s,response:i})}catch(a){t.messages.push({url:e.url,data:"ERROR Invalid request. Request body is not valid JSON",response:i});i.writeHead(200,{"Content-Type":"text/html"});i.write(JSON.stringify({Status:"ERROR",Message:"Inavlid request. Request body is not valid JSON"}));if(t.socket){t.socket.send(JSON.stringify({status:"error",message:"ERROR Invalid request. Request body is not valid JSON"}))}i.end();return}if(t.socket){t.processMessages()}})}});this.httpServer.on("listening",function(){t.wsServer=new c.server({httpServer:t.httpServer,autoAcceptconnections:false});t.wsServer.on("request",function(e){let i=e.accept(null,e.orgin);if(e.resource==="/port"){t.socket=i;t.processMessages();i.on("close",function(){t.messages=[];t.sources=[];t.actions=[];t.tasks=[]})}})});e();this.httpServer.listen(this.port)}onWordsReceived(e){var t=this;this.actions.forEach(function(i){let n=e.words.trim();if(i.hey_jibo&&i.hey_jibo.heard){let a=n.indexOf("hey jibo ");if(a!==-1){n=n.substr(a+9,n.length)}}e.utterances=[{utterance:n}];e.status="normal";e.audio_source_id=i.audio_source_id;e.speaker_idstatus="NOT-USED";e.task_id=i.task_id;if(i.nuance_curlmulti){e.simple_recog_name=i.nuance_curlmulti.name}if(i.hey_jibo&&!i.hey_jibo.heard){if(n.substr(n.length-8,n.length)==="hey jibo"){i.hey_jibo.heard=true;e.final_simple=true;e.words="hey jibo";e.simple_recog_name=i.hey_jibo.name;t.sendSpeakerId(e,"Speaker ID TD");let o=s(e);t.socket.send(JSON.stringify(o));if(!i.nuance_curlmulti){t.sendFinal(e)}}}else if(!i.hey_jibo||i.hey_jibo.heard){if(i.sensory_spkr_id_ti&&!i.sensory_spkr_id_ti.heard){i.sensory_spkr_id_ti.heard=true;e.final_simple=true;t.sendSpeakerId(e,i.sensory_spkr_id_ti.name)}if(e.final){e.final_simple=true;if(i.sensory_speech_detector){let r=s(e,{sd_status:"endpoint",simple_recog_name:i.sensory_speech_detector.name});t.socket.send(JSON.stringify(r))}}else{e.final_simple=false}let o=s(e);t.socket.send(JSON.stringify(o));if(e.final){t.sendFinal(e)}}});return}sendFinal(e){e.final_simple=false;e.final_composite=true;let t=s(e);this.socket.send(JSON.stringify(t))}sendSpeakerId(e,t){let i={};if(e.speaker){i.speaker_idstatus="ACCEPTED";i.speaker_ids=[e.speaker]}else{i.speaker_idstatus="NO-SPEAKERS-TO-LIST"}i.simple_recog_name=t;let n=s(e,i);this.socket.send(JSON.stringify(n))}processMessages(){while(this.messages.length){let e=this.messages.shift();this.connectionHandlers[e.url](e.data,e.response)}}onAsrInterface(e,t){let i={};i.status="received";if(e.action==="init_and_start"){i.audio_source_id=e.audio_source_id;this.initAction(e,true)}else if(e.action==="init"){i.audio_source_id=e.audio_source_id;this.initAction(e,false)}else if(e.action==="start"){let n;this.actions.forEach(function(t){if(t.task_id===e.task_id){t.started=true;n=true}});if(!n){i.status="error attempted to start nonexistent action "+e.task_id}}else if(e.action==="clear"){let a=0;let o;while(a<this.actions.length){if(this.actions[a].task_id===e.task_id){o=a}a++}this.actions.splice(o,1)}i.task_id=e.task_id;i.speaker_idstatus="NOT-USED";t.writeHead(200,{"Content-Type":"text/html"});t.write(JSON.stringify({Status:"OK",Message:"received data request"}));t.end();let r=s(i);this.socket.send(JSON.stringify(r));return}initAction(e,t){let i={};this.tasks.push({task_id:e.task_id,task:e.task});i=this.parseTasks(i,e.task);i.audio_source_id=e.audio_source_id;i.task_id=e.task_id;i.started=t;this.actions.push(i)}parseTasks(e,t){let i=t.split("{");i.forEach(function(t){let i=t.slice(8,t.length);if(i){let n=i.split(`"`)[0];i=i.split("-")[0];e[i]={};e[i].name=n;e[i].heard=true;if(i==="hey_jibo"){e.hey_jibo.heard=false}else if(i==="sensory_speech_detector"){e.sensory_speech_detector.heard=false}else if(i==="sensory_spkr_id_ti"){e.sensory_spkr_id_ti.heard=false}else if(i==="nuance_curlmulti"){e.nuance_curlmulti.heard=false}}});return e}onAudioSource(e,t){if(e.action==="start"){this.sources.push(e.audio_source_id);this.currentSource=e.audio_source_id}else if(e.action==="clear"){let i=this.sources.indexOf(e.audio_source_id);this.sources.splice(i,1)}t.writeHead(204,{"Content-Type":"text/html"});t.write(JSON.stringify({Status:"OK",Message:"received data request"}));t.end();let n={status:"received",audio_source_id:e.audio_source_id,task_id:e.audio_source_id};let a=s(n);try{this.socket.send(JSON.stringify(a))}catch(o){console.error(o)}return}onSpkrId(e,t){t.writeHead(200,{"Content-Type":"text/html"});t.write(JSON.stringify({Status:"OK",Message:"received data request"}));t.end();let i={status:"received",type:"spkrId"};try{this.socket.send(JSON.stringify(i))}catch(n){console.error(n)}return}}i["default"]=new u},{http:void 0,uuid:void 0,"websocket-without-native":void 0}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=0;class s{constructor(){this.ts=[0,0];this.type=undefined;this.id=n++;this.position={x:undefined,y:undefined,z:undefined},this.confidence=undefined}updatePosition(e){this.position.x=e.x;this.position.y=e.y;this.position.z=e.z}updateId(e){this.id=e}updateType(e){this.type=e}updateConfidence(e){this.confidence=e}updateTs(e){this.ts=e}getId(){return this.id}}i["default"]=s},{}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=0;class s{constructor(){let e=arguments.length<=0||arguments[0]===undefined?undefined:arguments[0];this.id=e.id||n++,this.confidence=undefined,this.description=undefined,this.position={x:e.x,y:e.y,z:e.z},this.orientation={x:undefined,y:undefined,z:undefined},this.extent={x:undefined,y:undefined,z:undefined},this.static=undefined,this.parts=[{key:undefined,value:{id:undefined,confidence:undefined,visible:undefined,tracker:{position:{x:undefined,y:undefined,z:undefined},rotation:{x:undefined,y:undefined,z:undefined},velocity:{x:undefined,y:undefined,z:undefined},angVelocity:{x:undefined,y:undefined,z:undefined}},extent:{x:undefined,y:undefined,z:undefined},rays:[{origin:{x:0,y:0,z:0},dir:{x:e.x,y:e.y,z:e.z},cameraId:undefined,tag:undefined,timestamp:{time_since_epoch:{count:undefined}}}],trackers:[{id:undefined,cameraId:undefined,confidence:undefined,covariance:{n11:undefined,n12:undefined,n21:undefined,n22:undefined},points:[],rectangle:{left:undefined,top:undefined,right:undefined,bottom:undefined},velocity:{x:undefined,y:undefined},inFOV:undefined,visible:undefined,lastUpdate:{time_since_epoch:{count:undefined}},name:undefined,needModelUpdate:undefined}]}}]}updatePosition(e){this.parts[0].value.rays[0].dir.x=e.x;this.parts[0].value.rays[0].dir.y=e.y;this.parts[0].value.rays[0].dir.z=e.z;this.position.x=e.x;this.position.y=e.y;this.position.z=e.z}updateId(e){this.id=e}}i["default"]=s},{}],7:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("http"),a=n(s),o=e("websocket-without-native"),r=e("./entity"),d=n(r),c=e("./audio-entity"),u=n(c),l=e("events"),f=n(l),h=e("uuid"),p=n(h),m=e("path"),v=n(m),g=e("fs-extra"),y=n(g),_=e("find-root"),S=n(_);class w extends f.default{constructor(){super();this.port=12476;this.cameras=[];this.entities=[];this.audioEntities=[];this.visualState={cameras:this.cameras,entities:this.entities};this.audioState={entities:this.audioEntities};this.connectionHandlers={"/lps/visual_awareness":this.onVisualAwareness.bind(this),"/lps/audible_awareness":this.onAudibleAwareness.bind(this)};this.httpHandlers={"/media/photo":this.onPhoto.bind(this),"/lps/barcode":this.onBarcode.bind(this)};setInterval(this.update.bind(this),100)}init(e){var t=this;this.httpServer=a.default.createServer();this.httpServer.on("listening",function(){t.wsServer=new o.server({httpServer:t.httpServer,autoAcceptConnections:false});t.wsServer.on("request",function(e){let i=e.accept(null,e.origin);if(!t.connectionHandlers[e.resource]){console.warn("No simulator handler found for",e.resource)}else{t.connectionHandlers[e.resource](i)}});e()});this.httpServer.on("request",function(e,i){if(e.method==="POST"){if(t.httpHandlers[e.url]){t.httpHandlers[e.url](e,i)}else{i.writeHead(200,{"Content-Type":"text/plain"});i.end()}}else{let n=(0,S.default)(__dirname);let s=v.default.join(n,"assets/images/jibo.jpg");let a=y.default.readFileSync(s);i.writeHead(200,{"Content-Type":"image/gif"});i.end(a,"binary")}});this.httpServer.listen(this.port)}onPhoto(e,t){t.writeHead(200,{"Content-Type":"text/plain"});let i={};i.id=p.default.v4();t.end(JSON.stringify(i))}onBarcode(e,t){t.writeHead(200,{"Content-Type":"text/plain"});t.end()}onVisualAwareness(e){this.visualSocket=e}onAudibleAwareness(e){this.audibleSocket=e}updateTrackingState(e){this.visualState=e}getVisualEntityFromId(e){let t;this.entities.forEach(function(i){if(i.id==e){t=i}});return t}triggerAudioEvent(e){let t=new u.default;t.updatePosition(e);t.updateConfidence(100);this.audioEntities.push(t);let i=t.getId();this.currentAudioId=i;this.audioState.entities=this.audioEntities;this.emit("audio-event-start",e,i)}triggerAudioEventEnd(){var e=this;let t=this.currentAudioId;this.emit("audio-event-end",t);setTimeout(function(){e.removeAudioEntityById(t)},3e3)}getAudioEntityFromId(e){let t;this.audioEntities.forEach(function(i){if(i.id==e){t=i}});return t}getAudioEntities(){return this.audioEntities}removeAudioEntityById(e){let t=0;for(var i=0;i<this.audioEntities.length;i++){if(this.audioEntities[i].getId()===e){t=i}}if(t!==-1){this.audioEntities.splice(t,1);this.audioState.entities=this.audioEntities;return true}return false}onVisualEntityAudio(e){let t=this.getVisualEntityFromId(e);this.triggerAudioEvent(t.position);this.update()}setTargetId(e,t){this.entities.forEach(function(i){if(i.id===e){i.id=t}})}getEntities(){return this.entities}updateTarget(e){let t=this.getVisualEntityFromId(e.id);if(!t){t=new d.default(e);this.entities.push(t)}t.updatePosition(e);this.update();this.emit("update",e)}removeEntity(e){let t;for(let i=0;i<this.entities.length;i++){if(this.entities[i].id===e){t=i}}if(t||t===0){this.entities.splice(t,1)}}update(){if(this.visualSocket&&this.visualSocket.connected){this.visualSocket.send(JSON.stringify(this.visualState))}if(this.audibleSocket&&this.audibleSocket.connected){this.audibleSocket.send(JSON.stringify(this.audioState))}}}i["default"]=new w},{"./audio-entity":5,"./entity":6,events:void 0,"find-root":void 0,"fs-extra":void 0,http:void 0,path:void 0,uuid:void 0,"websocket-without-native":void 0}],8:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("http"),a=n(s),o=e("animation-utilities"),r=e("websocket-without-native"),d=e("lodash"),c=n(d);let u={ts:[0,0],pos:0,inc_pos:0,vel:0,cur:0,pwm:0,status:1,vel_limit:10,acc_limit:10,cur_limit:10,mode:4,ref:0,ticks:0},l={ts:[0,0],pelvis:c["default"].assign({},u),torso:c["default"].assign({},u),neck:c["default"].assign({},u)},f=c["default"].cloneDeep(l),h=[0,0,0],p=performance.now();class m{constructor(e,t,i){this.initialPosition=e;this.velocity=t;if(i===null||i===undefined){i=o.Clock.currentTime()}this.initialTime=i}getPosition(e){if(e===null||e===undefined){e=o.Clock.currentTime()}var t=e.subtract(this.initialTime);return this.initialPosition+this.velocity*t}getVelocity(){return this.velocity}}let v={pelvis:new m(0,0),torso:new m(0,0),neck:new m(0,0)};class g{constructor(){this.port=12475;this.stateSocketList=[];this.commandSocketList=[];this.ledSocketList=[];let e=this;let t=this.onAxisCommand.bind(this);let i=this.onLEDCommand.bind(this);let n=a.default.createServer(function(e,t){t.writeHead(404);t.end()});n.listen(this.port,function(){});this.server=new r.server({httpServer:n,autoAcceptConnections:false});this.server.on("request",function(n){let s=n.accept(null,n.origin);if(n.resource==="/axis_state"){e.stateSocketList.push(s);e.sendState();s.on("close",function(){if(e.stateSocketList.indexOf(s)>-1){e.stateSocketList.splice(e.stateSocketList.indexOf(s),1)}})}else if(n.resource==="/axis_command"){e.commandSocketList.push(s);s.on("message",t);s.on("close",function(){if(e.commandSocketList.indexOf(s)>-1){e.commandSocketList.splice(e.commandSocketList.indexOf(s),1)}e.reset()})}else if(n.resource==="/led_command"){e.ledSocketList.push(s);s.on("message",i);s.on("close",function(){if(e.ledSocketList.indexOf(s)>-1){e.ledSocketList.splice(e.ledSocketList.indexOf(s),1)}})}})}init(e){e()}sendState(){if(this.stateSocketList.length>0){let e=o.Clock.currentTime()._timestamp;f.neck.ts=e;f.torso.ts=e;f.pelvis.ts=e;f.ts=e;try{for(let t of this.stateSocketList){if(t.connected){t.send(JSON.stringify(f))}}}catch(i){}}}updateState(){let e=o.Clock.currentTime(),t=performance.now()-p<500;for(let i of Object.keys(v)){if(t){f[i].vel=v[i].getVelocity(e)}else{f[i].vel=0}f[i].pos=v[i].getPosition(e)}}onAxisCommand(e){p=performance.now();e=JSON.parse(e.utf8Data);let t=o.Clock.currentTime();for(let i of Object.keys(v)){if(e[i].mode===4){v[i]=new m(v[i].getPosition(t),e[i].value[0],t)}else if(e[i].mode===5){v[i]=new o.TrajectoryControllerSim(v[i].getPosition(t),v[i].getVelocity(t),t);v[i].updateCommand(e[i].value[1],e[i].value[0],e[i].value[2],e[i].acc_limit,e[i].vel_limit,t)}else if(e[i].mode===7){v[i]=new o.PosVelControllerSim(v[i].getPosition(t),v[i].getVelocity(t),t);v[i].updateCommand(e[i].value[1],e[i].value[0],e[i].acc_limit,e[i].vel_limit,t)}else{v[i]=new m(v[i].getPosition(t),0,t)}}this.updateState();this.sendState()}onLEDCommand(e){e=JSON.parse(e.utf8Data);if(e.color&&Array.isArray(e.color)&&e.color.length===3){h=e.color}}reset(){f=c.default.cloneDeep(l);v={pelvis:new m(0,0),torso:new m(0,0),neck:new m(0,0)}}render(e){this.updateState();e.display({topSection_r:f.neck.pos,middleSection_r:f.torso.pos,bottomSection_r:f.pelvis.pos,lightring_redChannelBn_r:h[0],lightring_greenChannelBn_r:h[1],lightring_blueChannelBn_r:h[2]})}}i["default"]=new g},{"animation-utilities":void 0,http:void 0,lodash:void 0,"websocket-without-native":void 0}],9:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("http"),a=n(s),o=e("find-root"),r=n(o),d=e("fs"),c=n(d),u=e("path"),l=u.join((0,r["default"])(__dirname),"..");let f=u.join(l,"parser/build/Release/jsjibonlu.jibo"),h=u.join(l,"parser/build/Release/jsjibonlu.node");c["default"].existsSync(f)&&c["default"].renameSync(f,h);var p=e(h),m=u.join(l,"parser","deps","data");p.set_data_dir(m);let v=0;class g{constructor(){this.port=11231;this.handles={}}init(e){var t=this;this.server=a.default.createServer();this.server.on("request",function(e,i){if(e.url==="/nlu_interface"&&e.method==="POST"){e.setEncoding("utf8");let n="";e.on("data",function(e){n+=e});e.on("end",function(){let e=undefined;try{e=JSON.parse(n)}catch(s){i.writeHead(200,{"Content-Type":"text/html"});i.write(JSON.stringify({Status:"ERROR",Message:"Inavlid request. Request body is not valid JSON"}));i.end();return}if(e.REQ_TYPE==="COMPILE"){t.compile(e.REQ_CONTENT.RULE_STRING,e.REQ_CONTENT.URI,i)}else if(e.REQ_TYPE==="PARSE_FROM_URI"){t.parseFromUri(e.REQ_CONTENT.URI,e.REQ_CONTENT.TXT_STRING,i)}else if(e.REQ_TYPE==="PARSE_FROM_TEXT"){t.parseFromText(e.REQ_CONTENT.RULE_STRING,e.REQ_CONTENT.TXT_STRING,i)}})}});this.server.on("listening",function(){e()});this.server.listen(this.port)}parseFromUri(e,t,i){let n={Status:"OK",URI:""};let s=this.handles[e];if(s&&p){let a=p.build_sentence_parser(s);let o=a.parse_sentence(t);n.Result=JSON.parse(o)}else{n.Status="ERROR";n.Message=`No handle named '${e}' exists`}i.writeHead(200,{"Content-Type":"text/html"});i.write(JSON.stringify(n));i.end()}parseFromText(e,t,i){let n={Status:"OK"};try{let s=p.compile_fst_from_text(e,`handle:${v++}`);let a=p.build_sentence_parser(s);let o=a.parse_sentence(t);n.Result=JSON.parse(o)}catch(r){n.Status="ERROR";n.Message=r.message}i.writeHead(200,{"Content-Type":"text/html"});i.write(JSON.stringify(n));i.end()}compile(e,t,i){let n={Status:"OK",URI:""};let s=`handle:${v++}`;if(t){s=t}try{this.handles[s]=p.compile_fst_from_text(e,s);n.URI=s}catch(a){n.Status="ERROR";n.Message=a.message}i.writeHead(200,{"Content-Type":"text/html"});i.write(JSON.stringify(n));i.end()}}i["default"]=new g},{"find-root":void 0,fs:void 0,http:void 0,path:void 0}],10:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("http"),a=n(s),o=e("./lps-service"),r=n(o),d=e("./nlu-service"),c=n(d),u=e("./asr-service"),l=n(u),f=e("./tts-service"),h=n(f),p=e("./motor-service"),m=n(p);let v=8181,g=[{name:"body",host:"127.0.0.1",port:m["default"].port},{name:"lps",host:"127.0.0.1",port:r["default"].port},{name:"nlu",host:"127.0.0.1",port:c["default"].port},{name:"asr",host:"127.0.0.1",port:l["default"].port},{name:"tts",host:"127.0.0.1",port:h["default"].port}];class y{init(e){this.server=a.default.createServer();this.server.on("request",function(e,t){if(e.method==="GET"){t.writeHead(200,{"Content-Type":"text/plain"});t.end(JSON.stringify(g),"utf8")}});this.server.on("listening",function(){e()});this.server.listen(v)}}i["default"]=new y},{"./asr-service":4,"./lps-service":7,"./motor-service":8,"./nlu-service":9,"./tts-service":12,http:void 0}],11:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("./lps-service"),a=n(s),o=e("./nlu-service"),r=n(o),d=e("./asr-service"),c=n(d),u=e("./tts-service"),l=n(u),f=e("./motor-service"),h=n(f),p=e("./registry-service"),m=n(p),v=e("async"),g=n(v);i["default"]=function(e){g["default"].parallel([function(e){a["default"].init(e)},function(e){r["default"].init(e)},function(e){c["default"].init(e)},function(e){l["default"].init(e)},function(e){h["default"].init(e)},function(e){m["default"].init(e)}],function(){e()})}},{"./asr-service":4,"./lps-service":7,"./motor-service":8,"./nlu-service":9,"./registry-service":10,"./tts-service":12,async:void 0}],12:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t,i){let n={token:e,timestamp:t,status:i,moreinfo:[]};return n}function a(e){let t=.2,i=[{name:"/pau/",start:0,end:t}];return e.split(" ").forEach(function(e){e=e.trim(),o(e[e.length-1])&&(e=e.substr(0,e.length-1)),i.push({name:e,start:t,end:t+.3}),t+=.3}),i.push({name:"/pau/",start:t,end:t+.2}),i}function o(e){return"."===e||","===e||"?"===e||"!"===e||";"===e||":"===e}Object.defineProperty(i,"__esModule",{value:!0});var r=e("http"),d=n(r),c=e("events"),u=e("websocket-without-native"),l=0;class f extends c.EventEmitter{constructor(){super();this.port=11275;this.messages=[];this.connectionHandlers={"/tts_token_times":this.onTokenTimes.bind(this),"/tts_speak":this.onSpeak.bind(this),"/tts_stop":this.onStop.bind(this)}}init(e){var t=this;this.httpServer=d.default.createServer();this.httpServer.on("request",function(e,i){if(e.url==="/tts_stop"){t.messages.push({url:e.url,response:i});t.processMessages()}e.setEncoding("utf8");e.on("data",function(n){let s;try{s=JSON.parse(n);t.messages.push({url:e.url,data:s,response:i});t.processMessages()}catch(a){console.error(a);t.messages.push({url:e.url,data:"ERROR Invalid request. Request body is not valid JSON",response:i});i.writeHead(200,{"Content-Type":"text/html"});i.write(JSON.stringify({Status:"ERROR",Message:"Inavlid request. Request body is not valid JSON"}));if(t.socket){t.socket.send(JSON.stringify({status:"error",message:"ERROR Invalid request. Request body is not valid JSON"}))}i.end();return}})});this.httpServer.on("listening",function(){t.wsServer=new u.server({httpServer:t.httpServer,autoAcceptconnections:false});t.wsServer.on("request",function(e){let i=e.accept(null,e.orgin);if(e.resource==="/tts_tokens"){t.tokenSocket=i;t.processMessages()}else if(e.resource==="/tts_phones"){t.phoneSocket=i;t.processMessages()}})});e();this.httpServer.listen(this.port)}processMessages(){while(this.messages.length){let e=this.messages.shift();l++;this.activeMessage=l;this.connectionHandlers[e.url](e.data,e.response,l)}}onSpeak(e,t,i){var n=this;this.emitting=true;t.writeHead(204,{"Content-Type":"text/html"});t.write(JSON.stringify({Status:"OK",Message:"Speaking TTS"}));t.end();let o=a(e.prompt);if(this.devMode){o.forEach(function(e){setTimeout(function(){if(n.activeMessage===i){n.emit("token",e.name)}},e.start*1e3)});setTimeout(function(){n.tokenSocket.send(JSON.stringify(s("",0,"STOP")))},o[o.length-1].end*1e3)}else{this.emit("speech",e.prompt);this.tokenSocket.send(JSON.stringify(s("",0,"STOP")))}}toggleDevMode(){this.devMode=!this.devMode}onTokenTimes(e,t){let i={tokentimes:{tokens:a(e.prompt)}};t.writeHead(200,{"Content-Type":"text/html"});t.write(JSON.stringify(i));t.end()}onStop(e,t){this.activeMessage=undefined;this.tokenSocket.send(JSON.stringify(s("",0,"STOP")));this.emitting=false;t.writeHead(200,{"Content-Type":"text/html"});t.write(JSON.stringify({Status:"OK",Message:"Stopping TTS"}));t.end();this.emit("stop")}}i["default"]=new f},{events:void 0,http:void 0,"websocket-without-native":void 0}],13:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("react"),a=n(s);i["default"]=a["default"].createClass({displayName:"asr-view",getInitialState(){
return{text:"",speaker:""}},componentDidMount(){this.inputStack=[""],this.inputIndex=1},onKeyDown(e){let t=e.target.value,i=e.nativeEvent.keyCode;t=t.trim().replace(/[\|&;\$%@"#<>\(\)\+,?.]/g,"").toLowerCase(),13===i?(this.saveInputText(t),this.setState({text:""}),this.props.onWords({words:t,"final":!0,speaker:this.state.speaker}),this.props.messageHandler({words:t,speaker:this.state.speaker})):32===i?this.props.onWords({words:t,incremental:!0,speaker:this.state.speaker}):38===i&&this.inputIndex>1?(this.inputIndex-=1,this.setState({text:this.inputStack[this.inputIndex]})):40===i&&this.inputIndex<this.inputStack.length&&(this.inputIndex+=1,this.setState({text:this.inputStack[this.inputIndex]}))},saveInputText(e){e!==this.inputStack[this.inputStack.length-1]&&this.inputStack.push(e),this.inputIndex=this.inputStack.length},onSpeakerChange(e){let t=e.target.value;this.setState({speaker:t})},onTtsToggle(){this.props.toggleTtsDevState(),this.setState({ttsDevMode:!this.state.ttsDevMode})},onChange(e){let t=e.target.value,i=t;t=t.trim().replace(/[\|&;\$%@"#<>\(\)\+,?.]/g,"").toLowerCase(),this.setState({text:i})},render(){return a["default"].createElement("div",{className:"asr-input"},a["default"].createElement("span",{className:"fa fa-comment chat-icon icon"}),a["default"].createElement("input",{type:"text",className:"text text-lg chat-input",placeholder:"Speak to Jibo here...",value:this.state.text,onChange:this.onChange,onKeyDown:this.onKeyDown}),a["default"].createElement("div",{className:"speaker row"},a["default"].createElement("div",{className:"row-label"},"Speaker"),a["default"].createElement("div",{className:"row-content"},a["default"].createElement("input",{type:"text",className:"text text-md speaker-input",placeholder:"Anybody",value:this.state.speaker,onChange:this.onSpeakerChange}))),a["default"].createElement("div",{className:"tts-mode row"},a["default"].createElement("div",{className:"row-label"},"TTS Mode"),a["default"].createElement("div",{className:"row-content"},a["default"].createElement("label",{htmlFor:"dev"},a["default"].createElement("input",{type:"radio",value:"dev",id:"dev",className:"radio",checked:!this.state.ttsDevMode,onChange:this.onTtsToggle}),"Dev"),a["default"].createElement("label",{htmlFor:"incremental"},a["default"].createElement("input",{type:"radio",value:"incremental",id:"incremental",className:"radio",checked:this.state.ttsDevMode,onChange:this.onTtsToggle}),"Incremental"))))}})},{react:void 0}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var n=e("animation-utilities");class s{constructor(e,t,i){this.scene=e;this.ts=[0,0];this.type=undefined;this.name=i;this.position={x:t.x,y:t.x,z:t.x},this.confidence=100;let s=new n.THREE.SphereGeometry(.1,32,32);let a=new n.THREE.MeshBasicMaterial({color:16711680,transparent:true,opacity:1});let o=new n.THREE.Mesh(s,a);o.name=i;o.position.x=t.x;o.position.y=t.y;o.position.z=t.z;this.sphere=o;e.add(o)}startScaling(e){this.cb=e;this.sphereScale=1;this.scale=setInterval(this._downScale.bind(this),100)}_downScale(){this.sphereScale-=.05;if(this.sphereScale<=0){this.removeFromScene();clearInterval(this.scale);this.cb()}else{this.sphere.scale.x=this.sphereScale;this.sphere.scale.y=this.sphereScale;this.sphere.scale.z=this.sphereScale}}setColor(e){this.sphere.material.color.setHex(e)}setOpacity(e){this.sphere.material.opacity=e}setName(e){this.name=e}updateType(e){this.type=e}updateConfidence(e){this.confidence=e}updateTs(e){this.ts=e}getId(){return this.id}removeFromScene(){let e=this.scene.getObjectByName(this.name);if(e){this.scene.remove(e)}}}i["default"]=s},{"animation-utilities":void 0}],15:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("react"),a=n(s);i["default"]=a["default"].createClass({displayName:"chat-message",getInitialState(){return{}},render(){let e="message-wrapper fade-in",t="";return"jibo"===this.props.message.author?e+=" jibo":this.props.message.author&&(t=a["default"].createElement("div",{className:"message-speaker"},this.props.message.author)),this.props.message["break"]?a["default"].createElement("div",{className:"message-session"}):a["default"].createElement("div",{className:e},t,a["default"].createElement("div",{className:"message-bubble"},a["default"].createElement("div",{className:"message-content"},this.props.message.content)))}})},{react:void 0}],16:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("react"),a=n(s),o=e("../services/tts-service"),r=n(o),d=e("./messages-list"),c=n(d),u=e("./asr-view"),l=n(u);i["default"]=a["default"].createClass({displayName:"chat-view",getInitialState(){return{isSelected:!1}},componentDidMount(){var e=this;this.chatProxy=this.props.chatProxy,r["default"].on("speech",function(t){e.messageHandler({words:t,speaker:"jibo"})}),r["default"].on("token",function(t){e.incrementalMessageHandler(t)}),r["default"].on("sending-tokens",function(){e.addMessage({content:"",author:"jibo"})}),r["default"].on("stop",function(){e.addMessage({content:"",author:"jibo"})}),window.addEventListener("resize",function(){e.forceUpdate()})},incrementalMessageHandler(e){let t=this.refs.messagesList.state.messages;"jibo"!==t[t.length-1].author&&this.refs.messagesList.addMessage({author:"jibo",content:""}),this.refs.messagesList.appendMessage(e)},messageHandler(e){this.addMessage({content:e.words,author:e.speaker}),this.props.onWords(e)},addMessage(e){e&&(e.date=new Date,this.refs.messagesList.addMessage(e))},toggleTtsDevState(){r["default"].toggleDevMode(),this.setState({ttsDevMode:!this.state.ttsDevMode})},render(){let e="chat-pane side-pane";return this.props.isSelected||(e+=" hidden"),a["default"].createElement("div",{className:e,ref:"root"},a["default"].createElement(c["default"],{ref:"messagesList",reloadWatcher:this.props.reloadWatcher}),a["default"].createElement(l["default"],{ref:"AsrView",messageHandler:this.messageHandler,onWords:this.props.onWords,toggleTtsDevState:this.toggleTtsDevState}))}})},{"../services/tts-service":12,"./asr-view":13,"./messages-list":18,react:void 0}],17:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("react"),a=n(s),o=e("./target-view"),r=n(o),d=e("../services/lps-service"),c=n(d),u=e("animation-utilities"),l=e("marked"),f=n(l),h=e("./audio-event"),p=n(h),m=0;i["default"]=a["default"].createClass({displayName:"lps-view",getInitialState(){return{isSelected:!1,targets:[],selectedTarget:""}},initializeMouseTargetPositioner(){this.mtp=new u.MouseTargetPositioner(this.props.visualizer,this.props.parent.getRobotRenderer().scene._camera,new u.THREE.Vector3(.2,0,.2),null,new u.THREE.Vector3(0,0,1),[]),this.mtp.setMouseFilters(function(e){return e.altKey&&!e.metaKey&&!e.ctrlKey},function(e){return e.shiftKey},function(e){return!e.shiftKey}),this.mtp.addPositionChangedCallback(function(e,t){if(t||0===t){let i=e;i.id=t,c["default"].updateTarget(i)}}),this.mtp.installRendererIntoScene(this.props.parent.getRobotRenderer().scene)},componentDidMount(){var e=this;this.audioEvents={},c["default"].on("audio-event-start",function(t,i){let n=e.props.parent.getRobotRenderer().scene.getScene(),s="sphere"+i,a=new p["default"](n,t,s);for(var o in e.audioEvents){let a=e.audioEvents[o];a.setColor(16777215),a.setOpacity(.5)}e.audioEvents[s]=a}),c["default"].on("audio-event-end",function(t){e.removeAudioEventById(t)})},removeAudioEventById(e){let t=this.audioEvents["sphere"+e];t.startScaling(function(){})},addMouseTarget(e){return this.mtp||this.initializeMouseTargetPositioner(),this.mtp.addTargetPositioner(e),c["default"].updateTarget({id:e,x:.2,y:0,z:.2}),this.setSelectedTarget(e),!0},setSelectedTarget(e){this.setState({selectedTarget:e}),this.mtp.selectTarget(e)},showEntities(){console.log(this.mtp.getTargetPositionerNames()),console.log(c["default"].getEntities())},addTarget(){this.addMouseTarget(m++)},removeTarget(e){c["default"].removeEntity(e),this.mtp.removeTargetPositioner(e)},render(){var e=this;let t="lps-pane side-pane";this.props.isSelected||(t+=" hidden");let i=[],n=c["default"].getEntities();n.forEach(function(t){let n=!(t.id!==e.state.selectedTarget);i.push(a["default"].createElement(r["default"],{setTargetId:c["default"].setTargetId.bind(c["default"]),target:t,isSelected:n,removeTarget:e.removeTarget.bind(e),onClick:e.setSelectedTarget}))});let s="Click the `Add Target` button to add a single target to Jibo's Local Perceptual Space.\n\n* `shift+scroll` to zoom in and out.\n\n* `shift+drag` to move camera.\n\n* `shift+alt+drag` to move the LPS target on the ground.\n\n* `alt+drag` to move the height of the target.",o=null;return a["default"].createElement("div",{className:t,ref:"rightPane"},a["default"].createElement("div",{className:"panel-heading"},a["default"].createElement("h2",{className:"target-heading"},"Targets")),a["default"].createElement("div",{className:"instructions",dangerouslySetInnerHTML:{__html:(0,f["default"])(s,{sanitize:!0})}}),a["default"].createElement("div",{className:"lps-controls"},a["default"].createElement("button",{className:"btn",onClick:this.addTarget},a["default"].createElement("span",{className:"fa fa-plus"})," Add Target"),o),a["default"].createElement("div",{className:"arguments-scroll-container"},i))}})},{"../services/lps-service":7,"./audio-event":14,"./target-view":19,"animation-utilities":void 0,marked:void 0,react:void 0}],18:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("react"),a=n(s),o=e("./chat-message"),r=n(o);i["default"]=a["default"].createClass({displayName:"messages-list",getInitialState(){return{messages:[]}},componentDidMount(){var e=this;this.props.reloadWatcher.on("reload",function(){e.addMessage({"break":!0})})},addMessage(e){var t=this.state.messages;t.push(e),this.setState({messages:t})},appendMessage(e){if("/pau/"!==e){let t=this.state.messages[this.state.messages.length-1];t?(t.content+=e+" ",this.forceUpdate()):(t={author:"jibo",content:e,date:new Date},this.addMessage(t))}},componentWillUpdate(){var e=this.refs.messageContainer.getDOMNode();this.shouldScrollBottom=e.scrollTop+e.offsetHeight+15>=e.scrollHeight},componentDidUpdate(){if(this.shouldScrollBottom){var e=this.refs.messageContainer.getDOMNode();e.scrollTop=e.scrollHeight}},render(){var e;return e=this.state.messages.map(function(e){return""!==e.content?a["default"].createElement(r["default"],{message:e}):void 0}),e.length||(e=a["default"].createElement("div",{className:"chat-no-messages"},"No messages")),a["default"].createElement("div",{ref:"messageContainer",className:"chat-messages"},e)}})},{"./chat-message":15,react:void 0}],19:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("react"),a=n(s);i["default"]=a["default"].createClass({displayName:"target-view",getInitialState(){return{id:this.props.target.id,isSelected:this.props.isSelected}},componentDidMount(){this.id=this.props.target.id},onIdChange(e){let t=e.target.value;this.props.setTargetId(this.props.target.id,t),this.setState({id:t})},onClick(){this.props.onClick(this.props.target.id)},onRemoveTarget(){this.setState({isSelected:!0}),this.props.removeTarget(this.props.target.id)},render(){let e,t=this.props.target.parts[0].value.rays[0].dir;for(e in t)t[e]=Number(t[e]).toFixed(5);let i=this.props.isSelected?"lpsTarget isSelected":"lpsTarget unselected";return a["default"].createElement("div",{className:i,onClick:this.onClick},a["default"].createElement("button",{className:"btn remove",onClick:this.onRemoveTarget},a["default"].createElement("span",{className:"fa fa-times"})),a["default"].createElement("div",{className:"targetId"},a["default"].createElement("span",{className:"title"},"ID:"),a["default"].createElement("span",{className:"value"},this.props.target.id)),a["default"].createElement("div",{className:"location"},a["default"].createElement("span",{className:"value x"},"x: ",t.x),",",a["default"].createElement("span",{className:"value y"},"y: ",t.y),",",a["default"].createElement("span",{className:"value z"},"z: ",t.z)))}})},{react:void 0}],20:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(i,"__esModule",{value:!0});var s=e("react"),a=n(s);i["default"]=a["default"].createClass({displayName:"toolbar",getInitialState(){return{}},componentWillMount(){var e=this;this.showCameraView=!1,document.addEventListener("click",function(t){for(let i=t.target;i!=document.body;){if(i&&i.id&&"viewTrigger"==i.id)return;if(!i.parentNode)break;i=i.parentNode}e.setShowCameraViewPopup(!1)})},onCameraSelected(e){this.props.setCamera(e.target.id),this.toggleCameraViewPicker()},toggleCameraViewPicker(){this.showCameraView=!this.showCameraView,this.forceUpdate()},selectMode(e){this.mode=e.target.id,this.props.setMode(this.mode)},setShowCameraViewPopup(e){this.showCameraView=e,this.forceUpdate()},render(){let e=this.showCameraView?"show":"hide",t=this.showCameraView?"selected":"unselected",i="audio"===this.mode?"selected":"unselected",n="target"===this.mode?"selected":"unselected";return a["default"].createElement("div",null,a["default"].createElement("div",{className:"tools-top"},a["default"].createElement("button",{id:"audio",className:"top main "+i,onClick:this.selectMode},a["default"].createElement("span",{id:"audio",className:"fa fa-microphone icon"})),a["default"].createElement("button",{id:"target",className:"top main "+n,onClick:this.selectMode},a["default"].createElement("span",{id:"target",className:"fa fa-dot-circle-o icon"}))),a["default"].createElement("div",{className:"tools-bottom"},a["default"].createElement("button",{id:"viewTrigger",className:"bottom main "+t,onClick:this.toggleCameraViewPicker},a["default"].createElement("span",{className:"fa fa-video-camera icon"})),a["default"].createElement("div",{className:"popup  "+e,id:"viewPopup"},a["default"].createElement("button",{className:"option",id:"viewTop",onClick:this.onCameraSelected},"Top"),a["default"].createElement("button",{className:"option",id:"viewFront",onClick:this.onCameraSelected},"Front"),a["default"].createElement("button",{className:"option",id:"viewReset",onClick:this.onCameraSelected},"Reset"))))}})},{react:void 0}],21:[function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t,i){if(H=!0,"2d"===i.viewMode){t.style.zIndex="-1",document.getElementById("visualizer").opacity="0.01";var n=0,s=setInterval(function(){return n++>=4?(clearInterval(s),t.style.zIndex="0",document.getElementById("visualizer").opacity="1.0",void(t.className="")):(i.viewMode="3d"===i.viewMode?"2d":"3d",window.onDimensionChanges(),void window.onViewModeChange())},10)}}var a=e("react"),o=n(a),r=e("./services/service-initializer"),d=n(r),c=e("./services/asr-service"),u=n(c),l=e("./services/lps-service"),f=n(l),h=e("./views/chat-view"),p=n(h),m=e("./views/lps-view"),v=n(m),g=e("./react-components/tab-bar"),y=n(g),_=e("events"),S=n(_),w=e("ipc"),b=n(w),E=e("./face-on-body"),k=n(E),x=e("./services/motor-service"),T=n(x),N=e("animation-utilities"),C=e("./dimensions"),O=n(C),R=e("async"),M=n(R);let I="true"===b["default"].sendSync("is-remote-mode");I&&(O["default"].CHAT_WIDTH=0);let P=o["default"].createClass({displayName:"View",getInitialState(){return{currentView:"chat"}},componentWillMount(){this.reloadWatcher=new S["default"]},render(){var e=this;let t=[{label:"Chat",id:"chatTab",icon:"icon fa fa-comment",callback:function(){e.setState({currentView:"chat"})}},{label:"LPS",id:"lpsTab",icon:"icon fa fa-compass",callback:function(){e.setState({currentView:"lps"})}}],i="chat"==this.state.currentView;if(I)return o["default"].createElement("div",null);let n,s,a;return n=o["default"].createElement(y["default"],{tabs:t}),s=o["default"].createElement(p["default"],{ref:"chat",onWords:this.onWords,isSelected:i,reloadWatcher:this.reloadWatcher}),a=o["default"].createElement(v["default"],{ref:"lps",isSelected:!i,robotRenderer:this.robotRenderer,parent:this,visualizer:this.visualizer,updateTargets:this.forceUpdate.bind(this)}),o["default"].createElement("div",null,n,s,a)},getVisualizerContainer(){return this.visualizer},getRobotRenderer(){return this.robotRenderer},componentDidMount(){var e=this;f["default"].on("update",function(){e.forceUpdate()});let t,i=this.props.robotInfo,n=function(e,i){t.isDevToolsOpened()&&i.isDevToolsOpened===!1?t.closeDevTools():t.isDevToolsOpened()||i.isDevToolsOpened!==!0||t.openDevTools()},a=document.getElementById("container"),o=document.getElementById("face"),r=document.getElementById("visualizer");this.visualizer=r,k["default"].init(i,a,o,r,n,function(i,n,a){e.robotRenderer=n,t=document.getElementById("webview"),t.src=b["default"].sendSync("get-skill-path"),o.className="loading",b["default"].on("reload-skill",function(){o.className="loading",t.reloadIgnoringCache(),e.reloadWatcher.emit("reload")}),t.addEventListener("dom-ready",function(){!t.isDevToolsOpened()&&a.isDevToolsOpened&&t.openDevTools(),t.insertCSS("html{min-width: 1280px; min-height: 720px;} body{min-width: 1280px; min-height: 720px; margin: 0px; overflow: hidden;}"),s(t,o,a),"3d"===a.viewMode&&(o.className="")});let r=function d(){T["default"].render(n),requestAnimationFrame(d)};requestAnimationFrame(r)})},onWords(e){u["default"].onWordsReceived(e)}});M["default"].series([function(e){I?(b["default"].send("registry-init","http://127.0.0.1:8181"),e()):(0,d["default"])(function(){b["default"].send("registry-init","http://127.0.0.1:8181"),e()})},function(e){let t=new N.JiboConfig;N.RobotInfo.createInfo(t,function(t){o["default"].render(o["default"].createElement(P,{robotInfo:t,asrService:u["default"]}),document.getElementById("sidebar")),e()})}],function(e){e&&console.error(`Simulator: ${e}`)});var H=!1},{"./dimensions":1,"./face-on-body":2,"./react-components/tab-bar":3,"./services/asr-service":4,"./services/lps-service":7,"./services/motor-service":8,"./services/service-initializer":11,"./views/chat-view":16,"./views/lps-view":17,"animation-utilities":void 0,async:void 0,events:void 0,ipc:void 0,react:void 0}]},{},[21])(21)});